<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auction & Catalog Service</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center">Auction & Catalog Service</h1>

        <!-- Auction Section -->
        <h2>Auction Management</h2>
        <button class="btn btn-primary" onclick="getAllAuctions()">Get All Auctions</button>
        <button class="btn btn-success" onclick="createAuction()">Create Auction</button>
        <button class="btn btn-warning" onclick="placeBid()">Place Bid</button>
        <div id="auction-result" class="mt-3"></div>

        <hr />

        <!-- Catalog Section -->
        <h2>Catalog Management</h2>
        <button class="btn btn-primary" onclick="getAllProducts()">Get All Products</button>
        <button class="btn btn-success" onclick="addProduct()">Add Product</button>
        <div id="catalog-result" class="mt-3"></div>
    </div>

    <script>
        const auctionApiUrl = 'http://localhost:4000/Auction'; // Change to your actual backend URL
        const catalogApiUrl = 'http://localhost:5000/Catalog';

        // Display data in a target element
        function displayResult(targetId, data) {
            document.getElementById(targetId).innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        // Get All Auctions
        async function getAllAuctions() {
            try {
                const response = await fetch(`${auctionApiUrl}/GetAll`);
                const data = await response.json();
                displayResult('auction-result', data);
            } catch (err) {
                alert('Error fetching auctions: ' + err.message);
            }
        }

        // Create Auction
        async function createAuction() {
            const productId = prompt("Enter Product ID for the Auction:");
            const body = { productId: productId };

            try {
                const response = await fetch(`${auctionApiUrl}/Create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                displayResult('auction-result', data);
            } catch (err) {
                alert('Error creating auction: ' + err.message);
            }
        }

        // Place Bid
        async function placeBid() {
            const auctionId = prompt("Enter Auction ID to place bid:");
            const userId = prompt("Enter User ID:");
            const value = prompt("Enter Bid Amount:");

            const body = {
                auctionId: auctionId,
                userId: userId,
                value: parseFloat(value)
            };

            try {
                const response = await fetch(`${auctionApiUrl}/bid`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                const data = await response.json();
                displayResult('auction-result', data);
            } catch (err) {
                alert('Error placing bid: ' + err.message);
            }
        }

        // Get All Products
        async function getAllProducts() {
            try {
                const response = await fetch(`${catalogApiUrl}/GetAllProducts`);
                const data = await response.json();
                displayResult('catalog-result', data);
            } catch (err) {
                alert('Error fetching products: ' + err.message);
            }
        }

        // Add Product
        async function addProduct() {
            const name = prompt("Enter Product Name:");
            const price = prompt("Enter Product Price:");
            const releaseDate = prompt("Enter Release Date (YYYY-MM-DD):");
            const expiryDate = prompt("Enter Expiry Date (YYYY-MM-DD):");

            const body = {
                id: "00000000-0000-0000-0000-000000000000", // New product
                name: name,
                price: parseFloat(price),
                releaseDate: releaseDate,
                expiryDate: expiryDate,
                imageUrls: []
            };

            try {
                const response = await fetch(`${catalogApiUrl}/AddProduct`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                displayResult('catalog-result', data);
            } catch (err) {
                alert('Error adding product: ' + err.message);
            }
        }
    </script>
</body>

</html>